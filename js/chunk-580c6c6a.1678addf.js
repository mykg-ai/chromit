(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-580c6c6a"],{"7ba8":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"main",attrs:{id:"favoriteKg-id"}},[t.loading?t._e():a("svg",[a("g",{staticClass:"g-zoom"},[a("g",{staticClass:"g-move2center"},[a("g",{staticClass:"link-container"},[a("defs",[t._l(t.svgData.c2i,function(t){return a("marker",{staticClass:"center-inner-marker",attrs:{id:"marker-"+t.id,orient:"auto",markerWidth:"10",markerHeight:"10",viewBox:"-14 -10 28 20"}},[a("path",{attrs:{d:"M0,0L -12,8L-12,-8L0,0"}})])}),t._l(t.svgData.i2o,function(t){return a("marker",{staticClass:"inner-outer-marker",attrs:{id:"marker-"+t.id,orient:"auto",markerWidth:"10",markerHeight:"10",viewBox:"-14 -10 28 20"}},[a("path",{attrs:{d:"M0,0L -12,8L-12,-8L0,0"}})])})],2),t._l(t.svgData.c2i,function(t){return a("g",{staticClass:"center-inner-path",attrs:{id:"path-"+t.id,"marker-end":"url(#marker-"+t.id+")"}},[a("path")])}),t._l(t.svgData.i2o,function(t){return a("g",{staticClass:"inner-outer-path",attrs:{id:"path-"+t.id,"marker-end":"url(#marker-"+t.id+")"}},[a("path")])})],2),a("g",{staticClass:"node-container"},[a("g",{staticClass:"node-center"},[a("circle",{staticStyle:{fill:"#fff"},attrs:{r:t.centerNodeProp.r1}}),a("circle",{attrs:{r:t.centerNodeProp.r2}}),a("text",{domProps:{innerHTML:t._s(t.$options.filters.handleCenterText(t.svgData.center.name))}})]),t._l(t.svgData.inner,function(e){return a("g",{staticClass:"node-inner"},[a("rect",{attrs:{width:t.innerNodeProp.w,height:t.innerNodeProp.h,x:-t.innerNodeProp.w/2,y:-t.innerNodeProp.h/2}}),a("text",{domProps:{innerHTML:t._s(t.$options.filters.handleInnerText(e.name))}})])}),t._l(t.svgData.outer,function(e){return a("g",{staticClass:"node-outer"},[a("circle",{attrs:{r:t.outerNodeProp.r}}),a("text",{domProps:{innerHTML:t._s(t.$options.filters.handleOuterText(e.name))}})])})],2)])])]),a("div",{staticClass:"svg-tool"},[a("el-tooltip",{attrs:{content:t.$t("favoriteKg.a1"),placement:"top","open-delay":2e3,effect:"light"}},[a("img",{attrs:{src:"/static/img/full_screen.svg"},on:{click:function(e){t.fullScreen=!t.fullScreen,t.clickFullScreen()}}})]),a("el-tooltip",{attrs:{content:t.$t("favoriteKg.a2"),placement:"top","open-delay":2e3,effect:"light"}},[a("img",{attrs:{src:"/static/img/transform.svg"},on:{click:function(e){return t.clickTransform()}}})]),a("el-tooltip",{attrs:{content:t.$t("favoriteKg.a3"),placement:"top","open-delay":2e3,effect:"light"}},[a("img",{attrs:{src:"/static/img/"+(t.lock?"lock":"unlock")+".svg"},on:{click:function(e){return t.clickLock()}}})]),a("el-tooltip",{attrs:{content:t.$t("favoriteKg.a4"),placement:"top","open-delay":2e3,effect:"light"}},[a("img",{attrs:{src:"/static/img/refresh.svg"},on:{click:function(e){return t.refreshSvg()}}})])],1)])},r=[],i=a("fd65");const s=(t,e)=>{t.related_links=[],t.related_nodes=[];var a=i["i"](),n=[],r=[],s=[],o=0;return e.forEach(e=>{if(null!=e){var i=e.sysTags.concat(e.userTags),l={id:"i-"+n.length,name:e.title,parse:e.parse,tags:i,url:e.url,related_links:[],related_nodes:[]};n.push(l),i.forEach(t=>{var e=a.get(t);null==e&&(e={id:"o-"+o,name:t,related_links:[],related_nodes:[]},o++,a.set(t,e));var n={id:"l-"+l.id+"-"+e.id,source:l.id,target:e.id};s.push(n),l.related_nodes.push(e.id),l.related_links.push(n.id),e.related_nodes.push(l.id),e.related_links.push(n.id)});var c={id:"l-"+t.id+"-"+l.id,source:t.id,target:l.id};r.push(c),l.related_nodes.push(t.id),l.related_links.push(c.id),t.related_nodes.push(l.id),t.related_links.push(c.id)}}),{center:t,inner:n,outer:a.values(),nodes:n.concat(a.values()).concat([t]),c2i:r,i2o:s,links:r.concat(s)}},o=(t,e,a,n,r,i)=>{var s=l(t.source,!0,e),o=l(t.target,!0,e),c=l(t.source,!1,e),h=l(t.target,!1,e),d=0,u=0,m=0,g=0;if(t.id.indexOf("l-c")>-1){var f=Math.atan2(h-c,o-s),p=n.r1,v=r.w,k=r.h,x=(d=s+Math.cos(f)*p,u=c+Math.sin(f)*p,f<-Math.PI/2||f>Math.PI/2?-1:1),N=f>=0?1:-1;f>=-a&&f<=a||f>=Math.PI-a&&f<=Math.PI||f>=-Math.PI&&f<=-Math.PI+a?(m=o-v/2*x,g=h-v/2*Math.tan(f)*x):(m=o-k/2/Math.tan(f)*N,g=h-k/2*N)}else{f=Math.atan2(h-c,o-s),v=r.w,k=r.h;var P=i.r;m=o-Math.cos(f)*P,g=h-Math.sin(f)*P,x=f<-Math.PI/2||f>Math.PI/2?-1:1,N=f>=0?1:-1;f>=-a&&f<=a||f>=Math.PI-a&&f<=Math.PI||f>=-Math.PI&&f<=-Math.PI+a?(d=s+v/2*x,u=c+v/2*Math.tan(f)*x):(d=s+k/2/Math.tan(f)*N,u=c+k/2*N)}return"M"+[d,u]+"L"+[m,g]},l=(t,e,a)=>{return e?("fx"in t&&""!=t.fx&&null!=t.fx?t.fx:t.x)*a:("fy"in t&&""!=t.fy&&null!=t.fy?t.fy:t.y)*a};var c=a("4e13"),h={name:"FavoriteKg",data(){return{favoriteList:[],loading:!0,lock:!1,fullScreen:!1,simulation:null,svgData:{center:{},nodes:[],links:[]},centerNodeProp:{r1:54,r2:50},innerNodeProp:{w:100,h:30},outerNodeProp:{r:30},baseZoomInNum:6,minAndMaxZoom:[.2,5],forceStrength:-10,theta0:null,zoom:null}},props:["homeActive"],watch:{$route(t,e){this.changeRoute(t)}},filters:{handleCenterText(t){return this.handleText(t,14,4)},handleInnerText(t){return this.handleText(t,13,1)},handleOuterText(t){return this.handleText(t,8,3)},handleText(t,e,a){for(var n=Math.min(a,Math.ceil(this.getBLen(t)/e))>2?1:0,r=0,i=0,s='<tspan x="0" y="'+12*(i-n)+'">',o=0;o<t.length;o++)if(s+=t.charAt(o),r+=this.isCn(t.charAt(o))?2:1,r>e){if(r=0,i+=1,s+="</tspan>",i>=a){s+="...";break}o<t.length-1&&(s+='<tspan x="0" y="'+12*(i-n)+'">')}return s},getBLen(t){return null==t?0:("string"!=typeof t&&(t+=""),t.replace(/[^\x00-\xff]/g,"ab").length)},isCn(t){return null!=t.match(/[^\x00-\xff]/gi)}},mounted(){this.changeRoute(this.$route),window.onresize=this.updateSvgSize},methods:{clickFullScreen(){if(this.fullScreen){let t=document.getElementById("favoriteKg-id");t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen()}else document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},clickTransform(){if(0!=this.svgData.nodes.length){var t=null,e=null,a=null,n=null,r=parseInt(document.getElementsByTagName("svg")[0].attributes.width.value),s=parseInt(document.getElementsByTagName("svg")[0].attributes.height.value);this.svgData.nodes.forEach(r=>{var i=r.id.indexOf("c")>-1?this.centerNodeProp.r1:r.id.indexOf("i")>-1?this.innerNodeProp.w/2:this.outerNodeProp.r,s=r.id.indexOf("c")>-1?this.centerNodeProp.r1:r.id.indexOf("i")>-1?this.innerNodeProp.h/2:this.outerNodeProp.r;n=Math.max(n,r.x*this.baseZoomInNum+i),e=Math.min(e,r.x*this.baseZoomInNum-i),t=Math.min(t,r.y*this.baseZoomInNum-s),a=Math.max(a,r.y*this.baseZoomInNum+s)});var o=n-e,l=r,c=a-t,h=s,d=Math.min(l/o,h/c),u=(n+e)/2*d,m=(a+t)/2*d,g=(1-d)/2;i["l"]("svg").transition().duration(1e3).call(this.zoom.transform,i["o"].translate(l*g-u,h*g-m).scale(d))}},clickLock(){this.lock=!this.lock,this.lock?(this.svgData.nodes.forEach(t=>{t.fx=t.x,t.fy=t.y}),this.simulation.stop()):(this.svgData.nodes.forEach(t=>{t.fx=null,t.fy=null}),this.simulation.alphaTarget(.1).restart())},refreshSvg(){this.lock&&this.clickLock(),i["l"]("svg").call(this.zoom.transform,i["o"])},changeRoute(t){this.loading=!0,this.homeActive.isLogin||this.$router.push({path:"/login"}),"q"in this.$route.query||this.$router.push({path:"/favorite"}),this.$axios.get(c["a"].url+"/favorite/search?keywords="+this.$route.query.q).then(t=>{this.favoriteList=t.data,this.loading=!1,this.handleSvg(this.$route.query.q,this.favoriteList)}).catch(t=>this.loading=!1)},updateSvgSize(){var t=document.getElementById("favoriteKg-id").offsetWidth,e=document.getElementById("favoriteKg-id").offsetHeight;i["l"]("svg").attr("width",t).attr("height",e),i["l"](".g-move2center").attr("transform","translate("+[t/2,e/2]+")")},handleSvg(t,e){this.theta0=Math.atan2(this.innerNodeProp.h,this.innerNodeProp.w),new Promise((a,n)=>{var r={name:t,id:"c-0"};this.svgData=s(r,e),a()}).then(()=>{this.updateSvgSize(),this.zoom=i["n"]().scaleExtent(this.minAndMaxZoom).on("zoom",t=>{i["l"](".g-zoom").attr("transform",i["d"].transform)}),i["l"]("svg").call(this.zoom).on("dblclick.zoom",null),this.simulation=i["h"](this.svgData.nodes).force("charge",i["g"]().strength(this.forceStrength)).force("link",i["f"](this.svgData.links).id(t=>t.id)).force("center",i["e"]())}).then(()=>{var t=i["b"]().on("start",t=>{i["d"].active||this.simulation.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y}).on("drag",t=>{t.fx+=i["d"].dx/this.baseZoomInNum,t.fy+=i["d"].dy/this.baseZoomInNum}).on("end",t=>{i["d"].active||this.lock||this.simulation.alphaTarget(0),this.lock||(t.fx=null,t.fy=null)});i["l"](".node-center").data([this.svgData.center]).call(t),i["m"](".center-inner-path path").data(this.svgData.c2i),i["m"](".node-inner").data(this.svgData.inner).call(t).on("dblclick",t=>{window.open(t.url,"_blank").location}),i["m"](".inner-outer-path path").data(this.svgData.i2o),i["m"](".node-outer").data(this.svgData.outer).call(t)}).then(()=>{this.simulation.on("tick",()=>{i["l"](".node-center").attr("transform",t=>"translate("+[l(t,!0,this.baseZoomInNum),l(t,!1,this.baseZoomInNum)]+")"),i["m"](".center-inner-path path").attr("d",t=>o(t,this.baseZoomInNum,this.theta0,this.centerNodeProp,this.innerNodeProp,this.outerNodeProp)),i["m"](".node-inner").attr("transform",t=>"translate("+[l(t,!0,this.baseZoomInNum),l(t,!1,this.baseZoomInNum)+")"]),i["m"](".inner-outer-path path").attr("d",t=>o(t,this.baseZoomInNum,this.theta0,this.centerNodeProp,this.innerNodeProp,this.outerNodeProp)),i["m"](".node-outer").attr("transform",t=>"translate("+[l(t,!0,this.baseZoomInNum),l(t,!1,this.baseZoomInNum)+")"])})}).then(()=>setTimeout(this.clickTransform,1e3))}}},d=h,u=(a("8aa5"),a("17cc")),m=Object(u["a"])(d,n,r,!1,null,"2e22ab14",null);e["default"]=m.exports},"8aa5":function(t,e,a){"use strict";var n=a("d2b4"),r=a.n(n);r.a},d2b4:function(t,e,a){}}]);