(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f201e86"],{"56e8":function(t,e,n){},"7ba8":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"main",attrs:{id:"favoriteKg-id"}},[t.loading?t._e():n("svg",[n("g",{staticClass:"g-zoom"},[n("g",{staticClass:"g-move2center"},[n("g",{staticClass:"link-container"},[n("defs",[t._l(t.svgData.c2i,function(t){return n("marker",{staticClass:"center-inner-marker",attrs:{id:"marker-"+t.id,orient:"auto",markerWidth:"10",markerHeight:"10",viewBox:"-14 -10 28 20"}},[n("path",{attrs:{d:"M0,0L -12,8L-12,-8L0,0"}})])}),t._l(t.svgData.i2o,function(t){return n("marker",{staticClass:"inner-outer-marker",attrs:{id:"marker-"+t.id,orient:"auto",markerWidth:"10",markerHeight:"10",viewBox:"-14 -10 28 20"}},[n("path",{attrs:{d:"M0,0L -12,8L-12,-8L0,0"}})])})],2),t._l(t.svgData.c2i,function(t){return n("g",{staticClass:"center-inner-path",attrs:{id:"path-"+t.id,"marker-end":"url(#marker-"+t.id+")"}},[n("path")])}),t._l(t.svgData.i2o,function(t){return n("g",{staticClass:"inner-outer-path",attrs:{id:"path-"+t.id,"marker-end":"url(#marker-"+t.id+")"}},[n("path")])})],2),n("g",{staticClass:"node-container"},[n("g",{staticClass:"node-center"},[n("circle",{staticStyle:{fill:"#fff"},attrs:{r:t.centerNodeProp.r1}}),n("circle",{attrs:{r:t.centerNodeProp.r2}}),n("text",{domProps:{innerHTML:t._s(t.$options.filters.handleCenterText(t.svgData.center.name))}})]),t._l(t.svgData.inner,function(e){return n("g",{staticClass:"node-inner"},[n("rect",{attrs:{width:t.innerNodeProp.w,height:t.innerNodeProp.h,x:-t.innerNodeProp.w/2,y:-t.innerNodeProp.h/2}}),n("text",{domProps:{innerHTML:t._s(t.$options.filters.handleInnerText(e.name))}})])}),t._l(t.svgData.outer,function(e){return n("g",{staticClass:"node-outer"},[n("circle",{attrs:{r:t.outerNodeProp.r}}),n("text",{domProps:{innerHTML:t._s(t.$options.filters.handleOuterText(e.name))}})])})],2)])])]),n("div",{staticClass:"svg-tool"},[n("el-tooltip",{attrs:{content:t.$t("favoriteKg.a1"),placement:"top","open-delay":2e3,effect:"light"}},[n("img",{attrs:{src:"/static/img/full_screen.svg"},on:{click:function(e){t.fullScreen=!t.fullScreen,t.clickFullScreen()}}})]),n("el-tooltip",{attrs:{content:t.$t("favoriteKg.a2"),placement:"top","open-delay":2e3,effect:"light"}},[n("img",{attrs:{src:"/static/img/transform.svg"},on:{click:function(e){return t.clickTransform()}}})]),n("el-tooltip",{attrs:{content:t.$t("favoriteKg.a3"),placement:"top","open-delay":2e3,effect:"light"}},[n("img",{attrs:{src:"/static/img/"+(t.lock?"lock":"unlock")+".svg"},on:{click:function(e){return t.clickLock()}}})]),n("el-tooltip",{attrs:{content:t.$t("favoriteKg.a4"),placement:"top","open-delay":2e3,effect:"light"}},[n("img",{attrs:{src:"/static/img/refresh.svg"},on:{click:function(e){return t.refreshSvg()}}})])],1)])},r=[],i=n("db36"),s=n("fd65"),o=n("4e13"),l={name:"FavoriteKg",data(){return{favoriteList:[],loading:!0,lock:!1,fullScreen:!1,simulation:null,svgData:{center:{},nodes:[],links:[]},centerNodeProp:{r1:54,r2:50},innerNodeProp:{w:100,h:30},outerNodeProp:{r:30},baseZoomInNum:6,minAndMaxZoom:[.2,5],forceStrength:-10,theta0:null,zoom:null}},props:["homeActive"],watch:{$route(t,e){this.changeRoute(t)}},filters:{handleCenterText(t){return this.handleText(t,14,4)},handleInnerText(t){return this.handleText(t,13,1)},handleOuterText(t){return this.handleText(t,8,3)},handleText(t,e,n){for(var a=Math.min(n,Math.ceil(this.getBLen(t)/e))>2?1:0,r=0,i=0,s='<tspan x="0" y="'+12*(i-a)+'">',o=0;o<t.length;o++)if(s+=t.charAt(o),r+=this.isCn(t.charAt(o))?2:1,r>e){if(r=0,i+=1,s+="</tspan>",i>=n){s+="...";break}o<t.length-1&&(s+='<tspan x="0" y="'+12*(i-a)+'">')}return s},getBLen(t){return null==t?0:("string"!=typeof t&&(t+=""),t.replace(/[^\x00-\xff]/g,"ab").length)},isCn(t){return null!=t.match(/[^\x00-\xff]/gi)}},mounted(){this.changeRoute(this.$route),window.onresize=this.updateSvgSize},methods:{clickFullScreen(){if(this.fullScreen){let t=document.getElementById("favoriteKg-id");t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen()}else document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},clickTransform(){if(0!=this.svgData.nodes.length){var t=null,e=null,n=null,a=null,r=parseInt(document.getElementsByTagName("svg")[0].attributes.width.value),i=parseInt(document.getElementsByTagName("svg")[0].attributes.height.value);this.svgData.nodes.forEach(r=>{var i=r.id.indexOf("c")>-1?this.centerNodeProp.r1:r.id.indexOf("i")>-1?this.innerNodeProp.w/2:this.outerNodeProp.r,s=r.id.indexOf("c")>-1?this.centerNodeProp.r1:r.id.indexOf("i")>-1?this.innerNodeProp.h/2:this.outerNodeProp.r;a=Math.max(a,r.x*this.baseZoomInNum+i),e=Math.min(e,r.x*this.baseZoomInNum-i),t=Math.min(t,r.y*this.baseZoomInNum-s),n=Math.max(n,r.y*this.baseZoomInNum+s)});var o=a-e,l=r,c=n-t,h=i,d=Math.min(l/o,h/c),u=(a+e)/2*d,m=(n+t)/2*d,g=(1-d)/2;s["l"]("svg").transition().duration(1e3).call(this.zoom.transform,s["o"].translate(l*g-u,h*g-m).scale(d))}},clickLock(){this.lock=!this.lock,this.lock?(this.svgData.nodes.forEach(t=>{t.fx=t.x,t.fy=t.y}),this.simulation.stop()):(this.svgData.nodes.forEach(t=>{t.fx=null,t.fy=null}),this.simulation.alphaTarget(.1).restart())},refreshSvg(){this.lock&&this.clickLock(),s["l"]("svg").call(this.zoom.transform,s["o"])},changeRoute(t){this.loading=!0,this.homeActive.isLogin||this.$router.push({path:"/login"}),"q"in this.$route.query||this.$router.push({path:"/favorite"}),this.$axios.get(o["a"].url+"/favorite/search?keywords="+this.$route.query.q,{},!0).then(t=>{this.favoriteList=t.data,this.loading=!1,this.handleSvg(this.$route.query.q,this.favoriteList)}).catch(t=>this.loading=!1)},updateSvgSize(){var t=document.getElementById("favoriteKg-id").offsetWidth,e=document.getElementById("favoriteKg-id").offsetHeight;s["l"]("svg").attr("width",t).attr("height",e),s["l"](".g-move2center").attr("transform","translate("+[t/2,e/2]+")")},handleSvg(t,e){this.theta0=Math.atan2(this.innerNodeProp.h,this.innerNodeProp.w),new Promise((n,a)=>{var r={name:t,id:"c-0"};this.svgData=Object(i["c"])(r,e),n()}).then(()=>{this.updateSvgSize(),this.zoom=s["n"]().scaleExtent(this.minAndMaxZoom).on("zoom",t=>{s["l"](".g-zoom").attr("transform",s["d"].transform)}),s["l"]("svg").call(this.zoom).on("dblclick.zoom",null),this.simulation=s["h"](this.svgData.nodes).force("charge",s["g"]().strength(this.forceStrength)).force("link",s["f"](this.svgData.links).id(t=>t.id)).force("center",s["e"]())}).then(()=>{var t=s["b"]().on("start",t=>{s["d"].active||this.simulation.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y}).on("drag",t=>{t.fx+=s["d"].dx/this.baseZoomInNum,t.fy+=s["d"].dy/this.baseZoomInNum}).on("end",t=>{s["d"].active||this.lock||this.simulation.alphaTarget(0),this.lock||(t.fx=null,t.fy=null)});s["l"](".node-center").data([this.svgData.center]).call(t),s["m"](".center-inner-path path").data(this.svgData.c2i),s["m"](".node-inner").data(this.svgData.inner).call(t).on("dblclick",t=>{window.open(t.url,"_blank").location}),s["m"](".inner-outer-path path").data(this.svgData.i2o),s["m"](".node-outer").data(this.svgData.outer).call(t)}).then(()=>{this.simulation.on("tick",()=>{s["l"](".node-center").attr("transform",t=>"translate("+[Object(i["a"])(t,!0,this.baseZoomInNum),Object(i["a"])(t,!1,this.baseZoomInNum)]+")"),s["m"](".center-inner-path path").attr("d",t=>Object(i["b"])(t,this.baseZoomInNum,this.theta0,this.centerNodeProp,this.innerNodeProp,this.outerNodeProp)),s["m"](".node-inner").attr("transform",t=>"translate("+[Object(i["a"])(t,!0,this.baseZoomInNum),Object(i["a"])(t,!1,this.baseZoomInNum)+")"]),s["m"](".inner-outer-path path").attr("d",t=>Object(i["b"])(t,this.baseZoomInNum,this.theta0,this.centerNodeProp,this.innerNodeProp,this.outerNodeProp)),s["m"](".node-outer").attr("transform",t=>"translate("+[Object(i["a"])(t,!0,this.baseZoomInNum),Object(i["a"])(t,!1,this.baseZoomInNum)+")"])})}).then(()=>setTimeout(this.clickTransform,1e3))}}},c=l,h=(n("b4c9"),n("17cc")),d=Object(h["a"])(c,a,r,!1,null,"5991c54e",null);e["default"]=d.exports},b4c9:function(t,e,n){"use strict";var a=n("56e8"),r=n.n(a);r.a},db36:function(t,e,n){"use strict";n.d(e,"c",function(){return r}),n.d(e,"b",function(){return i}),n.d(e,"a",function(){return s});var a=n("fd65");const r=(t,e)=>{t.related_links=[],t.related_nodes=[];var n=a["i"](),r=[],i=[],s=[],o=0;return e.forEach(e=>{if(null!=e){var a=e.sysTags.concat(e.userTags),l={id:"i-"+r.length,name:e.title,parse:e.parse,tags:a,url:e.url,related_links:[],related_nodes:[]};r.push(l),a.forEach(t=>{var e=n.get(t);null==e&&(e={id:"o-"+o,name:t,related_links:[],related_nodes:[]},o++,n.set(t,e));var a={id:"l-"+l.id+"-"+e.id,source:l.id,target:e.id};s.push(a),l.related_nodes.push(e.id),l.related_links.push(a.id),e.related_nodes.push(l.id),e.related_links.push(a.id)});var c={id:"l-"+t.id+"-"+l.id,source:t.id,target:l.id};i.push(c),l.related_nodes.push(t.id),l.related_links.push(c.id),t.related_nodes.push(l.id),t.related_links.push(c.id)}}),{center:t,inner:r,outer:n.values(),nodes:r.concat(n.values()).concat([t]),c2i:i,i2o:s,links:i.concat(s)}},i=(t,e,n,a,r,i)=>{var o=s(t.source,!0,e),l=s(t.target,!0,e),c=s(t.source,!1,e),h=s(t.target,!1,e),d=0,u=0,m=0,g=0;if(t.id.indexOf("l-c")>-1){var f=Math.atan2(h-c,l-o),p=a.r1,v=r.w,k=r.h,x=(d=o+Math.cos(f)*p,u=c+Math.sin(f)*p,f<-Math.PI/2||f>Math.PI/2?-1:1),b=f>=0?1:-1;f>=-n&&f<=n||f>=Math.PI-n&&f<=Math.PI||f>=-Math.PI&&f<=-Math.PI+n?(m=l-v/2*x,g=h-v/2*Math.tan(f)*x):(m=l-k/2/Math.tan(f)*b,g=h-k/2*b)}else{f=Math.atan2(h-c,l-o),v=r.w,k=r.h;var N=i.r;m=l-Math.cos(f)*N,g=h-Math.sin(f)*N,x=f<-Math.PI/2||f>Math.PI/2?-1:1,b=f>=0?1:-1;f>=-n&&f<=n||f>=Math.PI-n&&f<=Math.PI||f>=-Math.PI&&f<=-Math.PI+n?(d=o+v/2*x,u=c+v/2*Math.tan(f)*x):(d=o+k/2/Math.tan(f)*b,u=c+k/2*b)}return"M"+[d,u]+"L"+[m,g]},s=(t,e,n)=>{return e?("fx"in t&&""!=t.fx&&null!=t.fx?t.fx:t.x)*n:("fy"in t&&""!=t.fy&&null!=t.fy?t.fy:t.y)*n}}}]);